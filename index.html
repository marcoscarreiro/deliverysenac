<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="delivery.css">
    <title>Delivery Senac</title>
</head>

<body>
    <nav class="navegacao">
        <ul>
            <li><a href="./">üçï Delivery</a></li>
            <li><button id="adicionarPizza">‚ûï üçï</button></li>
            <li><button id="abrirCarrinho">üõí</button></li>
        </ul>
    </nav>
    <h1>Pizzas</h1>
    <ul id="cardapio">
        <!-- Lista de pizzas -->
    </ul>
    <div id="checkout" class="checkout">
        <button id="fecharCarrinho">‚ùå</button>
        <h2>Pedido</h2>
        <ul id="carrinho"></ul>
        <div class="total"></div>
    </div>
    <!--Tag dialog, √© uma janela modal, ela tem por padr√£o o display: none, para exibir a modal na tela muda-se a propriedade 'open'-->
    <dialog id="modal">
        <form id="cadastraPizza">
            <div>
                <label for="nome">Nome</label>
                <input type="text" name="nome" id="nome" required>
            </div>
            <div>
                <label for="foto">Foto</label>
                <input type="text" name="foto" id="foto" placeholder="imgs/nome.jpg" required>
            </div>
            <div>
                <label for="valor">Valor</label>
                <input type="number" step="0.01" name="valor" id="valor" required>
            </div>
            <div>
                <label for="ingredientes">Ingredientes</label>
                <input type="text" name="ingredientes" id="ingredientes">
            </div>
            <div>
                <button type="submit">Salvar</button>
            </div>
        </form>
    </dialog>
    <script src="pizzas.js"></script>
    <script>
        const cardapioUl = document.getElementById('cardapio');//<ul> id="cardapio"></ul>
        const modal = document.getElementById('modal');
        const formCadastro = document.getElementById('cadastraPizza');
        const adicionarPizza = document.getElementById('adicionarPizza');
        const carrinhoUl = document.getElementById('carrinho');//<ul> id="carrinho"</ul>        
        adicionarPizza.addEventListener('click', () => {
            modal.open = true;
        });
        formCadastro.addEventListener('submit', (evento) => {
            //para o envento padr√£o do formul√°rio
            evento.preventDefault();
            let nome = document.getElementById('nome').value
            let foto = document.getElementById('foto').value
            let valor = parseFloat(document.getElementById('valor').value)
            let ingredientes = document.getElementById('ingredientes').value
            let novaPizza = {
                foto: foto,
                nome: nome,
                ingredientes: [ingredientes],
                valor: valor
            };
            cardapio.push(novaPizza);
            console.log(cardapio);
            cardapioUl.innerHTML = "";
            exibirCardapio();
            modal.open = false;
        });
        //modal.open = true:        
        let carrinho = [];
        //zera a lista do card√°pio
        cardapioUl.innerHTML = "";
        //repeti√ß√£o para exibir a lista de pizzas no cardapio (ul)
        function exibirCardapio() {
            cardapio.forEach((pizza) => {
                //cria um elemento <li> para inserir cada pizza na UL
                const li = document.createElement('li');
                //atribui uma classe para a <li> criada
                li.className = "pizza";
                //cria um elemento <img> para adicionar a imagem da pizza
                const img = document.createElement('img');
                //atribui a foto da pizza para o 'src' da img
                img.src = pizza.foto
                //cria uma div para exibir os ingredientes da pizza
                const ingredientesDiv = document.createElement('div');
                ingredientesDiv.innerHTML = `(${pizza.ingredientes.join(' | ')})`;
                //atribui uma classe para os ingredientes
                ingredientesDiv.className = "ingredientes";
                //cria um bot√£o para adicionar a pizza ao carrinho
                const button = document.createElement('button');
                //texto para o bot√£o comprar
                button.textContent = "COMPRAR üçï";
                //montar card da pizza
                li.appendChild(img);
                li.append(`${pizza.nome} - R$ ${pizza.valor.toFixed(2)}`);
                li.appendChild(ingredientesDiv);
                li.appendChild(button);
                //adiciona a <li> dentro da <ul>
                cardapioUl.appendChild(li);
                //seleciona o bot√£o "Comprar" no <li> e escuta o evento 'click'
                li.querySelector('button').addEventListener('click', () => {
                    //quando o bot√£o √© clicado, adiciona a pizza em quest√£o ao array
                    carrinho.push(pizza);
                    //aviso de pizza adicionada
                    alert(`Pizza de ${pizza.nome} adicionada ao carrinho`);
                    //atualizar o carrinho ap√≥s adicionar a pizza
                    atualizarCarrinho();
                })
            });//Fim repeti√ß√£o cardapio
        }
        //===========================EVENTO ABRIR CARRINHO==============================
        //Seleciona o bot√£o no menu para abrir o carrinho
        const btnAbrirCarrinho = document.getElementById('abrirCarrinho');
        //seleciona a DIV "checkout" para manipular o display (block ou nome)
        const checkout = document.getElementById('checkout');
        btnAbrirCarrinho.addEventListener('click', () => {
            //altera o display da diva para o 'block'
            checkout.style.display = 'block';
        });
        //===========================EVENTO FECHAR CARRINHO=================================
        const fecharCarrinho = document.getElementById('fecharCarrinho');
        fecharCarrinho.addEventListener('click', () => {
            //Altera o display da div para o 'nome';
            checkout.style.display = 'none';
        });
        carrinhoUl.innerHTML = "<h4>üçï Seu carrinho est√° vazio üò¢</h4>";
        //===========================ATUALIZAR CARRINHO======================================
        function atualizarCarrinho() {
            carrinhoUl.innerHTML = ""
            //criar a variavel para o total a pagar
            let total = 0;
            //---------------------adicionar itens ao carrinho---------------------------------
            carrinho.forEach((pizza) => {
                const liCarrinho = document.createElement('li');
                //adiciona classe ao <li> do carrinho
                liCarrinho.className = "item_carrinho";
                //difinir o conte√∫do <li> do carrinho
                liCarrinho.textContent = `${pizza.nome} - R$ ${pizza.valor.toFixed(2)}`;
                carrinhoUl.appendChild(liCarrinho);
                //cria bot√£o para remover item do carrinho
                const removerBtn = document.createElement('button');
                removerBtn.textContent = "‚ùé";
                //define uma classe para o bot√£o remover
                removerBtn.className = 'btn_remover';
                total += pizza.valor;
                liCarrinho.appendChild(removerBtn);
                removerBtn.addEventListener('click', () => {
                    let indiceClicado = carrinho.indexOf(pizza);
                    removerCarrinho();
                    alert(`Item Removido: Pizza de ${pizza.nome}`);
                });
            });
            //Exibe o valor total a pagar
            const divTotal = document.querySelector('.total');
            divTotal.innerHTML = `Total R$ ${total.toFixed(2)}`
        }//Fecha fun√ß√£o atualizar
        function removerCarrinho(indice) {
            //Remove o indice clicado.
            //Fun√ß√£o para Array.// Splice (onde come√ßa a remover, quantidade a remover).
            carrinho.splice(indice, 1);
            //Atualiza o carrinho ap√≥s a remo√ß√£o.
            atualizarCarrinho();
        }
        exibirCardapio();
    </script>
</body>

</html>